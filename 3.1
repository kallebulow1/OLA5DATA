library(httr)
library(jsonlite)

salgsdata <- read.csv("data/sales.csv")
waste <- read.csv("data/waste.csv")

head(salgsdata)

anyNA(salgsdata)
sum(is.na(salgsdata))
colSums(is.na(salgsdata))

# Summér madspild pr. store_id
waste_summary <- aggregate(waste_kg ~ store_id, data = waste, sum)

# Lav barplot
barplot(
  waste_summary$waste_kg,
  names.arg = waste_summary$store_id,
  xlab = "Butik (store_id)",
  ylab = "Madspild (kg)",
  main = "Madspild pr. butik",
  ylim = c(0, max(waste_summary$waste_kg) + 1)
)


# API URL
url <- "https://api.sallinggroup.com/v1/food-waste/?zip=8000"

api_key <- "SG_APIM_FPJ32HW2GNSPJ08EKD8YZQJ612ZJWMN06TQ5YTS83QMQJ3CZ55X0"

# Hent data med httr
response <- GET(
  url,
  add_headers(
    Authorization = paste("Bearer", api_key)
)
)

# Tjek statuskode
status_code(response)

# Læs JSON-indholdet
data_raw <- content(response, as = "text", encoding = "UTF-8")

# Konverter til data frame
waste_data <- fromJSON(data_raw)

# Vis de første rækker
head(waste_data)
